service: rum-shop-cart

frameworkVersion: '3'

package:
  patterns:
    - 'handler.js'
    - '../shared/**'
    - '../node_modules/**'

provider:
  name: aws
  runtime: nodejs20.x
  region: ${opt:region, 'us-east-1'}
  environment:
    DD_SERVICE: rum-shop-cart
    DD_ENV: ${opt:stage, 'production'}
    DD_VERSION: '1.0.0'
    NODE_OPTIONS: '--enable-source-maps'
  layers:
    - arn:aws:lambda:${aws:region}:464622532012:layer:Datadog-Node20-x:${env:DD_NODE_LAYER_VERSION, '65'}

functions:
  cart:
    handler: handler.handler
    description: RUM Shop Cart API - add, get, update, remove, clear
    events:
      # POST /api/cart/add
      - http:
          path: api/cart/add
          method: post
      # GET /api/cart/{sessionId}
      - http:
          path: api/cart/{sessionId}
          method: get
      # PUT /api/cart/update
      - http:
          path: api/cart/update
          method: put
      # DELETE /api/cart/{sessionId}/item/{productId}
      - http:
          path: api/cart/{sessionId}/item/{productId}
          method: delete
      # DELETE /api/cart/{sessionId}
      - http:
          path: api/cart/{sessionId}
          method: delete
    tags:
      service: rum-shop-cart
      project: rum-shop

# Datadog: Set DD_API_KEY or DD_KMS_API_KEY env var for APM. Layer ARN uses latest version.
