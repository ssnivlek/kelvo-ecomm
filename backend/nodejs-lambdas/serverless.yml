# RUM Shop - Deploy all Lambdas from nodejs-lambdas root: serverless deploy
# Deploy single function: serverless deploy function -f cart
service: rum-shop

frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs20.x
  region: ${opt:region, 'us-east-1'}
  environment:
    DD_ENV: ${opt:stage, 'production'}
    DD_VERSION: '1.0.0'
    JWT_SECRET: ${env:JWT_SECRET, 'rum-shop-secret-key-2024'}
    NODE_OPTIONS: '--enable-source-maps'
  layers:
    - arn:aws:lambda:${aws:region}:464622532012:layer:Datadog-Node20-x:${env:DD_NODE_LAYER_VERSION, '65'}

package:
  individually: true

functions:
  cart:
    handler: cart/handler.handler
    description: RUM Shop Cart API
    environment:
      DD_SERVICE: rum-shop-cart
    events:
      - http: { path: api/cart/add, method: post }
      - http: { path: api/cart/{sessionId}, method: get }
      - http: { path: api/cart/update, method: put }
      - http: { path: api/cart/{sessionId}/item/{productId}, method: delete }
      - http: { path: api/cart/{sessionId}, method: delete }
    tags:
      service: rum-shop-cart
      project: rum-shop

  auth:
    handler: auth/handler.handler
    description: RUM Shop Auth API
    environment:
      DD_SERVICE: rum-shop-auth
    events:
      - http: { path: api/auth/register, method: post }
      - http: { path: api/auth/login, method: post }
      - http: { path: api/auth/profile, method: get }
    tags:
      service: rum-shop-auth
      project: rum-shop

  payment:
    handler: payment/handler.handler
    description: RUM Shop Payment API (mock Stripe)
    environment:
      DD_SERVICE: rum-shop-payment
    events:
      - http: { path: api/payment/create-intent, method: post }
      - http: { path: api/payment/confirm, method: post }
      - http: { path: api/payment/webhook, method: post }
    tags:
      service: rum-shop-payment
      project: rum-shop
